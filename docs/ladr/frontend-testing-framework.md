# LADR: フロントエンドテストフレームワークの選択

## ステータス
承認済み

## 日付
2025年7月14日

## 文脈
ガスレスブログDAppのフロントエンド開発において、React/Next.jsアプリケーションの品質を保証するためのテストフレームワークの選択が必要である。以下の要件を満たすテスト戦略の策定を行う必要がある：

- 高速なユニットテスト実行
- React コンポーネントのテスト
- ユーザーインタラクションのテスト
- 優れた開発者体験（DX）
- TypeScript完全サポート
- CI/CD統合の容易さ
- 最小限の設定コスト
- ウォレット機能のモック対応

## 決定事項
以下のテスト戦略を採用する：

### 1. Vitest（ユニットテスト）
- **理由**:
  - **高速実行**: Viteベースの高速テストランナー
  - **Zero-config**: Vite設定の自動継承でほぼ設定不要
  - **TypeScript完全サポート**: 型チェック付きテスト実行
  - **HMR対応**: ホットリロードによる高速な開発サイクル
  - **Jest互換API**: 既存のJestテストからの移行が容易
  - **優れたスナップショット機能**: UI変更の検出とレビュー
  - **並列実行**: マルチスレッドによる高速テスト実行

### 2. React Testing Library
- **理由**:
  - **ユーザー中心のテスト**: 実際のユーザー操作に近いテスト
  - **アクセシビリティ重視**: セマンティックなセレクタの推奨
  - **実装詳細の回避**: UIの実装変更に強いテスト
  - **豊富なユーティリティ**: イベント、非同期処理のテストサポート
  - **Next.js公式推奨**: Next.jsドキュメントでの推奨テストライブラリ
  - **ウォレット連携テスト**: wagmiフックのモック機能

### 3. 主要なテスト対象とツール
- **React コンポーネント**: 基本的なレンダリングと prop 処理
- **ユーザーインタラクション**: クリック、入力、フォーム送信
- **非同期処理**: データフェッチ、ウォレット接続
- **カスタムフック**: wagmi、その他のReactフック
- **ユーティリティ関数**: lib/utils.ts の各種ヘルパー
- **@testing-library/jest-dom**: 追加のマッチャー提供
- **@testing-library/user-event**: リアルなユーザー操作シミュレーション

## 代替案
検討された代替案：

### Jest + React Testing Library
- **メリット**: 成熟したエコシステム、豊富なドキュメント、広い採用実績
- **デメリット**: 設定が複雑、実行速度が遅い、ESModules対応が不完全

### Cypress（E2E）
- **メリット**: 実ブラウザでのテスト、優れたデバッグ機能、豊富なAPI
- **デメリット**: 実行速度が非常に遅い、CI設定が複雑、メンテナンスコストが高い

### Playwright（E2E）
- **メリット**: 高速なE2Eテスト、マルチブラウザ対応、優れた開発者ツール
- **デメリット**: 学習コストが高い、初期設定が複雑、小規模プロジェクトではオーバーキル

### Storybook + Chromatic
- **メリット**: ビジュアルテスト、コンポーネントカタログ、デザインシステム連携
- **デメリット**: テスト網羅性が限定的、追加のインフラが必要、コストが高い

## 結果
この技術選択により以下の利益が期待される：

### 短期的な利益
- 高速なテスト実行（Jest比で2-3倍高速）
- 最小限の設定でテスト環境構築
- TypeScriptエラーの早期検出
- 開発中のリアルタイムテストフィードバック

### 長期的な利益
- ユーザー体験の品質向上
- リファクタリング時の安全性確保
- 新機能開発時の回帰テスト防止
- チーム開発での品質基準統一

### リスクとトレードオフ
- **リスク**: E2Eテストの欠如による統合部分のテスト不足
- **軽減策**: 重要なユーザーフローは手動テストで補完、将来的にPlaywrightを段階的導入

### パフォーマンス目標
- テスト実行時間: 10秒以下（全ユニットテスト）
- テスト起動時間: 2秒以下
- ウォッチモード: 1秒以下でのリテスト
- カバレッジ目標: 80%以上（重要な関数とコンポーネント）

### テスト戦略
#### Phase 1: 基本テスト（現在）
- ユーティリティ関数のユニットテスト
- React コンポーネントの基本動作テスト
- カスタムフックのテスト

#### Phase 2: 統合テスト（将来）
- ページレベルのテスト
- ウォレット連携フローのテスト
- APIモックを使用した統合テスト

#### Phase 3: E2Eテスト（必要に応じて）
- Playwrightを使用した重要フローのE2Eテスト
- ブラウザ間互換性テスト

## 実装計画
### 必要なパッケージ
```json
{
  "devDependencies": {
    "vitest": "^1.0.0",
    "@vitejs/plugin-react": "^4.0.0",
    "@testing-library/react": "^14.0.0",
    "@testing-library/jest-dom": "^6.0.0",
    "@testing-library/user-event": "^14.0.0",
    "happy-dom": "^12.0.0"
  }
}
```

### 設定ファイル
- `vitest.config.ts`: Vitestの設定
- `src/test/setup.ts`: テストセットアップファイル
- `src/test/utils.tsx`: テストユーティリティ

## 関連資料
- [Vitest ドキュメント](https://vitest.dev/)
- [React Testing Library ドキュメント](https://testing-library.com/docs/react-testing-library/intro/)
- [Next.js テストガイド](https://nextjs.org/docs/testing)
- [wagmi テストガイド](https://wagmi.sh/react/guides/testing)
- [Testing Library ベストプラクティス](https://kentcdodds.com/blog/common-mistakes-with-react-testing-library)
